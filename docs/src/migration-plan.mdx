# Sniptest Migration Plan

This document tracks the migration from inline code blocks and manual snippets to the new sniptest system.

## Goal

Migrate all code snippets to the sniptest workflow:
1. All code lives in `/testers/*.py` as testable Python files
2. All `/snippets/*.mdx` files are auto-generated (have `@sniptest` header)
3. All docs import from `/snippets/` (no inline code blocks)
4. CI/CD passes: `test_python_testers`, `test_snippets_are_autogenerated`, `test_no_snippets_outside_folder`

---

## Current State Analysis

### Overview by Section

| Section | Inline Code | Snippet Imports | Status |
|---------|-------------|-----------------|--------|
| **Getting Started** | 7 | 4 | Mixed |
| **Sessions (main)** | 27 | 18 | Heavy inline |
| **Sessions (capabilities)** | 46 | 0 | All inline |
| **Sessions (CDP)** | 20 | 0 | All inline |
| **Agents** | 0 | 59 | Clean (imports only) |
| **Functions** | 15 | 0 | All inline |
| **Agent Tools** | 9 | 2 | Mostly inline |
| **Scraping** | 20 | 0 | All inline |
| **Guides** | 2 | 8 | Mostly clean |

**Totals:**
- ~146 inline code blocks to extract
- ~90+ existing snippet imports to convert to testers
- 347 total files in `/snippets/` (many unused)

---

## Section Details

### 1. Getting Started
- `index.mdx`: 0 inline, 0 imports
- `quickstart.mdx`: 0 inline, 4 imports
- `concepts.mdx`: 7 inline, 0 imports

### 2. Sessions (Main Pages)
- `concepts/sessions.mdx`: 0 inline, 0 imports
- `features/sessions/lifecycle.mdx`: 3 inline, 8 imports
- `features/sessions/configuration.mdx`: 3 inline, 7 imports
- `features/sessions/browser-controls.mdx`: 19 inline, 0 imports
- `features/sessions/playwright-vs-notte.mdx`: 2 inline, 3 imports

### 3. Sessions (Capabilities)
- `browser-types.mdx`: 4 inline
- `browser-pools.mdx`: 0 inline
- `stealth-mode.mdx`: 9 inline
- `proxies.mdx`: 0 inline
- `multi-region.mdx`: 0 inline
- `captcha-solving.mdx`: 10 inline
- `ad-blocking.mdx`: 0 inline
- `browser-profiles.mdx`: 0 inline
- `static-ips.mdx`: 12 inline
- `recordings.mdx`: 3 inline
- `live-view.mdx`: 6 inline
- `browser-extensions.mdx`: 0 inline
- `cookies.mdx`: 2 inline

### 4. Sessions (CDP)
- `playwright.mdx`: 3 inline
- `puppeteer.mdx`: 1 inline
- `selenium.mdx`: 12 inline
- `external-providers.mdx`: 4 inline

### 5. Agents
- `concepts/agents.mdx`: 0 inline, 0 imports
- `features/agents/configuration.mdx`: 0 inline, 0 imports
- `features/agents/lifecycle.mdx`: 0 inline, 0 imports
- `features/agents/structured-output.mdx`: 0 inline, 19 imports
- `features/agents/replay.mdx`: 0 inline, 22 imports
- `features/agents/workflows.mdx`: 0 inline, 18 imports
- `features/agents/fallback.mdx`: 0 inline, 0 imports
- `features/agents/batch.mdx`: 0 inline, 0 imports

### 6. Functions
- `concepts/functions.mdx`: 13 inline, 0 imports
- `features/functions/creating.mdx`: 0 inline, 0 imports
- `features/functions/invocations.mdx`: 0 inline, 0 imports
- `features/functions/schedules.mdx`: 1 inline, 0 imports
- `features/functions/management.mdx`: 1 inline, 0 imports

### 7. Agent Tools
- `concepts/file-storage.mdx`: 9 inline, 0 imports
- `concepts/vaults.mdx`: 0 inline, 1 import
- `concepts/personas.mdx`: 0 inline, 1 import

### 8. Scraping
- `concepts/scraping.mdx`: 20 inline, 0 imports

### 9. Guides
- `guides/reliability.mdx`: 0 inline, 0 imports
- `guides/scraping.mdx`: 1 inline, 3 imports
- `guides/stealth.mdx`: 1 inline, 4 imports
- `guides/account_creation.mdx`: 0 inline, 1 import
- `guides/vibe-coding.mdx`: 0 inline, 0 imports

---

## Migration Process

For each file:
1. **Extract inline code** → create `/testers/{section}/{name}.py`
2. **Add `@sniptest` decorators** (filename, highlight, focus, show, etc.)
3. **Run `python sniptest/generate.py`** to generate `/snippets/`
4. **Update MDX** to import from `/snippets/` instead of inline code
5. **Verify** with `mintlify dev` that rendering is correct
6. **Test** with `DOCS_TEST_FAST_MODE=true pytest tests/test_snippets.py`

For existing snippets (no inline, just imports):
1. **Read the imported snippet** from `/snippets/`
2. **Create tester** in `/testers/` with the code + `@sniptest` decorators
3. **Regenerate** with `python sniptest/generate.py`
4. **Verify** the generated snippet matches (or improves on) the original

---

## ToDo List

### Phase 1: Infrastructure
- [x] Create sniptest parser (`/sniptest/parser.py`)
- [x] Create sniptest generator (`/sniptest/generate.py`)
- [x] Update test file to test `/testers/*.py`
- [x] Add `test_snippets_are_autogenerated` check
- [x] Add Makefile with `make sniptest` and `make sniptest-clean`
- [x] Add pre-commit hook to run snippet generation

### Phase 2: Agents (already clean - convert existing snippets) ✅
- [x] `snippets/agents/structured-output/` → `testers/agents/structured-output/` (19 files)
- [x] `snippets/agents/replay/` → `testers/agents/replay/` (22 files)
- [x] `snippets/agents/workflows/` → `testers/agents/workflows/` (18 files)
- [x] `snippets/agents/fallback/` → `testers/agents/fallback/` (21 files)
- [x] `snippets/agents/batch/` → `testers/agents/batch/` (21 files)
- [x] `snippets/agents/lifecycle/` → `testers/agents/lifecycle/` (20 files)
- [x] `snippets/agents/config/` → `testers/agents/config/` (17 files)
- [x] Other `snippets/agents/` root files (24 files)

**Phase 2 Total: 162 testers, all passing**

### Phase 3: Getting Started ✅
- [x] `concepts.mdx` - extract 7 inline blocks → `testers/getting-started/` (7 files with `show` feature)
- [~] `quickstart.mdx` - uses CodeGroup with Python/JS tabs (not supported by sniptest, remains manual)

**Phase 3 Total: 169 testers, all passing**

### Phase 4: Functions ✅
- [x] `concepts/functions.mdx` - extract 13 inline blocks → `testers/functions/` (15 files)
- [~] `features/functions/schedules.mdx` - only has comment-only Python blocks
- [~] `features/functions/management.mdx` - only has comment-only Python blocks
- [x] Convert existing `snippets/functions/` to testers:
  - Root level: 9 files
  - `creating/`: 22 files
  - `invocations/`: 16 Python files (12 non-Python files remain with CodeGroup - bash/cURL/JS)
  - `schedules/`: 11 files
  - `management/`: 25 files

**Phase 4 Total: 267 testers, all passing**

### Phase 5: Scraping ✅
- [x] `concepts/scraping.mdx` - extract 20 inline blocks → `testers/scraping/` (20 files)
- [x] Convert existing `snippets/scraping/` to testers (3 files)

**Phase 5 Total: 290 testers, all passing**

### Phase 6: Agent Tools ✅
- [x] `concepts/file-storage.mdx` - extract 9 inline blocks → `testers/file-storage/` (9 files)
- [x] `concepts/vaults.mdx` - convert 1 snippet import → `testers/vaults/` (1 file)
- [x] `concepts/personas.mdx` - convert 1 snippet import → `testers/personas/` (1 file)

**Phase 6 Total: 301 testers, all passing**

### Phase 7: Guides ✅
- [x] `guides/scraping.mdx` - extract 1 inline → `testers/guides/schema_design.py`, 3 imports already use sniptest snippets
- [x] `guides/stealth.mdx` - extract 1 inline → `testers/guides/browser_type_selection.py`, 4 imports → `testers/sessions/` (4 files)
- [x] `guides/account_creation.mdx` - convert 1 import → `testers/personas/create_account.py`

**Phase 7 Total: 308 testers, all passing**

### Phase 8: Sessions (Main) ✅
- [x] `features/sessions/browser-controls.mdx` - extract 19 inline → `testers/browser-controls/` (30 files total including imports)
- [x] `features/sessions/lifecycle.mdx` - extract 3 inline → `testers/sessions/lifecycle/` (4 files)
- [x] `features/sessions/configuration.mdx` - extract 3 inline → `testers/sessions/configuration/` (3 files)
- [x] `features/sessions/playwright-vs-notte.mdx` - extract 2 inline → `testers/sessions/playwright-vs-notte/` (2 files)
- [~] Existing `snippets/sessions/` with CodeGroup (lifecycle, configuration, playwright-vs-notte) remain manual (not Python-only)

**Phase 8 Total: 347 testers, all passing**

### Phase 9: Sessions (Capabilities) ✅
- [x] `live-view.mdx` - extract 6 inline → `testers/sessions/capabilities/` (6 files)
- [x] `recordings.mdx` - extract 3 inline → `testers/sessions/capabilities/` (3 files)
- [x] `cookies.mdx` - extract 2 inline → `testers/sessions/capabilities/` (2 files)
- [x] `stealth-mode.mdx` - extract 4 inline → `testers/sessions/capabilities/` (4 files)
- [x] `captcha-solving.mdx` - extract 6 inline → `testers/sessions/capabilities/` (6 files)
- [x] `static-ips.mdx` - extract 7 inline → `testers/sessions/capabilities/` (7 files)
- [~] `browser-types.mdx` - all CodeGroup wrappers, remain manual

**Phase 9 Total: 375 testers, all passing**

### Phase 10: Sessions (CDP) ✅
- [x] `features/sessions/playwright.mdx` - extract 3 inline → `testers/sessions/cdp/` (3 files)
- [x] `features/sessions/puppeteer.mdx` - extract 1 inline → `testers/sessions/cdp/` (1 file)
- [x] `features/sessions/selenium.mdx` - extract 12 inline → `testers/sessions/cdp/` (12 files)
- [x] `features/sessions/external-providers.mdx` - extract 4 inline → `testers/sessions/cdp/` (4 files)
- [~] Existing `snippets/sessions/cdp/` with CodeGroup wrappers remain manual (not Python-only)

**Phase 10 Total: 395 testers, all passing**

### Phase 11: Final Cleanup
- [ ] Run `make sniptest-clean` to remove orphan snippets (only safe after all migrations complete)
- [ ] Verify all tests pass: `DOCS_TEST_FAST_MODE=true pytest tests/test_snippets.py -v`
- [ ] Verify `test_no_snippets_outside_folder` passes (0 inline code)
- [ ] Verify `test_snippets_are_autogenerated` passes (all have `@sniptest` header)
- [ ] Verify `test_python_testers` passes (all testers valid)
- [ ] Run `mintlify dev` and spot-check docs render correctly
- [ ] Delete this migration plan file
- [ ] Create PR for merge

---

## Commands Reference

```bash
# Generate all snippets from testers
make sniptest

# Generate and remove orphan snippets
make sniptest-clean

# Run tests in fast mode
DOCS_TEST_FAST_MODE=true pytest tests/test_snippets.py -v

# Run specific test
DOCS_TEST_FAST_MODE=true pytest tests/test_snippets.py::test_python_testers -v

# Preview docs locally
mintlify dev
```

---

## Notes

- Non-Python code blocks (bash, JS, JSON) can remain inline for now
- Some snippets may need custom handlers in `test_snippets.py` for placeholder replacement
- The `show=` decorator is useful for hiding test harness code from docs while keeping it runnable

---

## Addendum: Inline Snippets Migration ✅

The following files had inline Python code that was migrated to testers:

| File | Status | Notes |
|------|--------|-------|
| `features/sessions/captcha-solving.mdx` | ✅ Migrated | 6 pure inline → `testers/sessions/captcha/` |
| `features/sessions/stealth-mode.mdx` | ✅ Migrated | 4 pure inline → `testers/sessions/stealth/` |
| `guides/web_automation_tips.mdx` | ✅ Migrated | 7 pure inline → `testers/guides/` |
| `features/sessions/browser-types.mdx` | ⏭️ Skipped | All CodeGroup (multi-language tabs) |
| `integrations/kernel.mdx` | ⏭️ Skipped | Integration-specific examples |
| `features/functions/schedules.mdx` | ⏭️ Skipped | Comment-only cron examples |
| `features/functions/management.mdx` | ⏭️ Skipped | Comment-only metadata example |

**Total: 17 testers created, 414 tests passing**

### Files with CodeGroup (Manual)

The following patterns remain manual because they use CodeGroup for multi-language tabs:
- `browser-types.mdx` - Python/JS tabs
- `captcha-solving.mdx` - CodeGroup wrappers for examples
- `stealth-mode.mdx` - CodeGroup wrappers for examples
- `kernel.mdx` - Integration guide
- `quickstart.mdx` - Python/JS tabs
- Various CDP files (playwright.mdx, selenium.mdx, puppeteer.mdx)

### Files Cleaned Up

**Deleted (unused in docs.json):**
- `product/scrape.mdx`
- `product/functions.mdx`
- `product/marketplace.mdx`
- `tutorials/setup-2fa-github.mdx`

**Simplified to enterprise placeholders:**
- `features/sessions/static-ips.mdx` - now matches `multi-region.mdx` pattern

**Orphaned snippets removed:**
- 68 orphaned snippet files deleted from `/snippets/`
- Empty directories cleaned up
